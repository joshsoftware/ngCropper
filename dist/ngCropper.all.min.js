!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t("object"==typeof exports?require("jquery"):jQuery)}(function(t){"use strict";function i(t){return"number"==typeof t&&!isNaN(t)}function e(t){return"undefined"==typeof t}function s(t,e){var s=[];return i(e)&&s.push(e),s.slice.apply(t,s)}function o(t,i){var e=s(arguments,2);return function(){return t.apply(i,e.concat(s(arguments)))}}function n(t){var i=t.match(/^(https?:)\/\/([^\:\/\?#]+):?(\d*)/i);return i&&(i[1]!==x.protocol||i[2]!==x.hostname||i[3]!==x.port)}function a(t){var i="timestamp="+(new Date).getTime();return t+(-1===t.indexOf("?")?"?":"&")+i}function h(t){return t?' crossOrigin="'+t+'"':""}function r(t,i){var e;return t.naturalWidth?i(t.naturalWidth,t.naturalHeight):(e=document.createElement("img"),e.onload=function(){i(this.width,this.height)},void(e.src=t.src))}function p(t){var e=[],s=t.rotate,o=t.scaleX,n=t.scaleY;return i(s)&&e.push("rotate("+s+"deg)"),i(o)&&i(n)&&e.push("scale("+o+","+n+")"),e.length?e.join(" "):"none"}function c(t,i){var e,s,o=vt(t.degree)%180,n=(o>90?180-o:o)*Math.PI/180,a=wt(n),h=xt(n),r=t.width,p=t.height,c=t.aspectRatio;return i?(e=r/(h+a/c),s=e/c):(e=r*h+p*a,s=r*a+p*h),{width:e,height:s}}function d(e,s){var o,n,a,h=t("<canvas>")[0],r=h.getContext("2d"),p=0,d=0,l=s.naturalWidth,g=s.naturalHeight,u=s.rotate,f=s.scaleX,m=s.scaleY,v=i(f)&&i(m)&&(1!==f||1!==m),w=i(u)&&0!==u,x=w||v,C=l,b=g;return v&&(o=l/2,n=g/2),w&&(a=c({width:l,height:g,degree:u}),C=a.width,b=a.height,o=a.width/2,n=a.height/2),h.width=C,h.height=b,x&&(p=-l/2,d=-g/2,r.save(),r.translate(o,n)),w&&r.rotate(u*Math.PI/180),v&&r.scale(f,m),r.drawImage(e,yt(p),yt(d),yt(l),yt(g)),x&&r.restore(),h}function l(t,i,e){var s,o="";for(s=i,e+=i;e>s;s++)o+=Dt(t.getUint8(s));return o}function g(t){var i,e,s,o,n,a,h,r,p,c,d=new y(t),g=d.byteLength;if(255===d.getUint8(0)&&216===d.getUint8(1))for(p=2;g>p;){if(255===d.getUint8(p)&&225===d.getUint8(p+1)){h=p;break}p++}if(h&&(e=h+4,s=h+10,"Exif"===l(d,e,4)&&(a=d.getUint16(s),n=18761===a,(n||19789===a)&&42===d.getUint16(s+2,n)&&(o=d.getUint32(s+4,n),o>=8&&(r=s+o)))),r)for(g=d.getUint16(r,n),c=0;g>c;c++)if(p=r+12*c+2,274===d.getUint16(p,n)){p+=8,i=d.getUint16(p,n),d.setUint16(p,1,n);break}return i}function u(t){var i,e=t.replace(Q,""),s=atob(e),o=s.length,n=new C(o),a=new b(n);for(i=0;o>i;i++)a[i]=s.charCodeAt(i);return n}function f(t){var i,e=new b(t),s=e.length,o="";for(i=0;s>i;i++)o+=Dt(e[i]);return"data:image/jpeg;base64,"+B(o)}function m(i,e){this.$element=t(i),this.options=t.extend({},m.DEFAULTS,t.isPlainObject(e)&&e),this.isLoaded=!1,this.isBuilt=!1,this.isCompleted=!1,this.isRotated=!1,this.isCropped=!1,this.isDisabled=!1,this.isReplaced=!1,this.isLimited=!1,this.isImg=!1,this.originalUrl="",this.canvas=null,this.cropBox=null,this.init()}var v=t(window),w=t(document),x=window.location,C=window.ArrayBuffer,b=window.Uint8Array,y=window.DataView,B=window.btoa,D="cropper",$="cropper-modal",L="cropper-hide",T="cropper-hidden",k="cropper-invisible",M="cropper-move",W="cropper-crop",X="cropper-disabled",Y="cropper-bg",R="mousedown touchstart pointerdown MSPointerDown",H="mousemove touchmove pointermove MSPointerMove",z="mouseup touchend touchcancel pointerup pointercancel MSPointerUp MSPointerCancel",O="wheel mousewheel DOMMouseScroll",E="dblclick",U="load."+D,I="error."+D,P="resize."+D,F="build."+D,A="built."+D,j="cropstart."+D,S="cropmove."+D,N="cropend."+D,q="crop."+D,_="zoom."+D,Z=/e|w|s|n|se|sw|ne|nw|all|crop|move|zoom/,K=/^data\:/,Q=/^data\:([^\;]+)\;base64,/,V=/^data\:image\/jpeg.*;base64,/,G="preview",J="action",tt="e",it="w",et="s",st="n",ot="se",nt="sw",at="ne",ht="nw",rt="all",pt="crop",ct="move",dt="zoom",lt="none",gt=t.isFunction(t("<canvas>")[0].getContext),ut=Number,ft=Math.min,mt=Math.max,vt=Math.abs,wt=Math.sin,xt=Math.cos,Ct=Math.sqrt,bt=Math.round,yt=Math.floor,Bt={version:"2.2.1"},Dt=String.fromCharCode;t.extend(Bt,{init:function(){var t,i=this.$element;if(i.is("img")){if(this.isImg=!0,this.originalUrl=t=i.attr("src"),!t)return;t=i.prop("src")}else i.is("canvas")&&gt&&(t=i[0].toDataURL());this.load(t)},trigger:function(i,e){var s=t.Event(i,e);return this.$element.trigger(s),s},load:function(i){var e,s,o=this.options,n=this.$element;if(i&&(n.one(F,o.build),!this.trigger(F).isDefaultPrevented())){if(this.url=i,this.image={},!o.checkOrientation||!C)return this.clone();if(e=t.proxy(this.read,this),K.test(i))return V.test(i)?e(u(i)):this.clone();s=new XMLHttpRequest,s.onerror=s.onabort=t.proxy(function(){this.clone()},this),s.onload=function(){e(this.response)},s.open("get",i),s.responseType="arraybuffer",s.send()}},read:function(t){var i,e,s,o=this.options,n=g(t),a=this.image;if(n>1)switch(this.url=f(t),n){case 2:e=-1;break;case 3:i=-180;break;case 4:s=-1;break;case 5:i=90,s=-1;break;case 6:i=90;break;case 7:i=90,e=-1;break;case 8:i=-90}o.rotatable&&(a.rotate=i),o.scalable&&(a.scaleX=e,a.scaleY=s),this.clone()},clone:function(){var i,e,s=this.options,o=this.$element,r=this.url,p="";s.checkCrossOrigin&&n(r)&&(p=o.prop("crossOrigin"),p||(p="anonymous",i=a(r))),this.crossOrigin=p,this.crossOriginUrl=i,this.$clone=e=t("<img"+h(p)+' src="'+(i||r)+'">'),this.isImg?o[0].complete?this.start():o.one(U,t.proxy(this.start,this)):e.one(U,t.proxy(this.start,this)).one(I,t.proxy(this.stop,this)).addClass(L).insertAfter(o)},start:function(){var i=this.$element,e=this.$clone;this.isImg||(e.off(I,this.stop),i=e),r(i[0],t.proxy(function(i,e){t.extend(this.image,{naturalWidth:i,naturalHeight:e,aspectRatio:i/e}),this.isLoaded=!0,this.build()},this))},stop:function(){this.$clone.remove(),this.$clone=null}}),t.extend(Bt,{build:function(){var i,e,s,o=this.options,n=this.$element,a=this.$clone;this.isLoaded&&(this.isBuilt&&this.unbuild(),this.$container=n.parent(),this.$cropper=i=t(m.TEMPLATE),this.$canvas=i.find(".cropper-canvas").append(a),this.$dragBox=i.find(".cropper-drag-box"),this.$cropBox=e=i.find(".cropper-crop-box"),this.$viewBox=i.find(".cropper-view-box"),this.$face=s=e.find(".cropper-face"),n.addClass(T).after(i),this.isImg||a.removeClass(L),this.initPreview(),this.bind(),o.aspectRatio=mt(0,o.aspectRatio)||NaN,o.viewMode=mt(0,ft(3,bt(o.viewMode)))||0,o.autoCrop?(this.isCropped=!0,o.modal&&this.$dragBox.addClass($)):e.addClass(T),o.guides||e.find(".cropper-dashed").addClass(T),o.center||e.find(".cropper-center").addClass(T),o.cropBoxMovable&&s.addClass(M).data(J,rt),o.highlight||s.addClass(k),o.background&&i.addClass(Y),o.cropBoxResizable||e.find(".cropper-line, .cropper-point").addClass(T),this.setDragMode(o.dragMode),this.render(),this.isBuilt=!0,this.setData(o.data),n.one(A,o.built),setTimeout(t.proxy(function(){this.trigger(A),this.isCompleted=!0},this),0))},unbuild:function(){this.isBuilt&&(this.isBuilt=!1,this.isCompleted=!1,this.initialImage=null,this.initialCanvas=null,this.initialCropBox=null,this.container=null,this.canvas=null,this.cropBox=null,this.unbind(),this.resetPreview(),this.$preview=null,this.$viewBox=null,this.$cropBox=null,this.$dragBox=null,this.$canvas=null,this.$container=null,this.$cropper.remove(),this.$cropper=null)}}),t.extend(Bt,{render:function(){this.initContainer(),this.initCanvas(),this.initCropBox(),this.renderCanvas(),this.isCropped&&this.renderCropBox()},initContainer:function(){var t=this.options,i=this.$element,e=this.$container,s=this.$cropper;s.addClass(T),i.removeClass(T),s.css(this.container={width:mt(e.width(),ut(t.minContainerWidth)||200),height:mt(e.height(),ut(t.minContainerHeight)||100)}),i.addClass(T),s.removeClass(T)},initCanvas:function(){var i,e=this.options.viewMode,s=this.container,o=s.width,n=s.height,a=this.image,h=a.naturalWidth,r=a.naturalHeight,p=90===vt(a.rotate),c=p?r:h,d=p?h:r,l=c/d,g=o,u=n;n*l>o?3===e?g=n*l:u=o/l:3===e?u=o/l:g=n*l,i={naturalWidth:c,naturalHeight:d,aspectRatio:l,width:g,height:u},i.oldLeft=i.left=(o-g)/2,i.oldTop=i.top=(n-u)/2,this.canvas=i,this.isLimited=1===e||2===e,this.limitCanvas(!0,!0),this.initialImage=t.extend({},a),this.initialCanvas=t.extend({},i)},limitCanvas:function(t,i){var e,s,o,n,a=this.options,h=a.viewMode,r=this.container,p=r.width,c=r.height,d=this.canvas,l=d.aspectRatio,g=this.cropBox,u=this.isCropped&&g;t&&(e=ut(a.minCanvasWidth)||0,s=ut(a.minCanvasHeight)||0,h&&(h>1?(e=mt(e,p),s=mt(s,c),3===h&&(s*l>e?e=s*l:s=e/l)):e?e=mt(e,u?g.width:0):s?s=mt(s,u?g.height:0):u&&(e=g.width,s=g.height,s*l>e?e=s*l:s=e/l)),e&&s?s*l>e?s=e/l:e=s*l:e?s=e/l:s&&(e=s*l),d.minWidth=e,d.minHeight=s,d.maxWidth=1/0,d.maxHeight=1/0),i&&(h?(o=p-d.width,n=c-d.height,d.minLeft=ft(0,o),d.minTop=ft(0,n),d.maxLeft=mt(0,o),d.maxTop=mt(0,n),u&&this.isLimited&&(d.minLeft=ft(g.left,g.left+g.width-d.width),d.minTop=ft(g.top,g.top+g.height-d.height),d.maxLeft=g.left,d.maxTop=g.top,2===h&&(d.width>=p&&(d.minLeft=ft(0,o),d.maxLeft=mt(0,o)),d.height>=c&&(d.minTop=ft(0,n),d.maxTop=mt(0,n))))):(d.minLeft=-d.width,d.minTop=-d.height,d.maxLeft=p,d.maxTop=c))},renderCanvas:function(t){var i,e,s=this.canvas,o=this.image,n=o.rotate,a=o.naturalWidth,h=o.naturalHeight;this.isRotated&&(this.isRotated=!1,e=c({width:o.width,height:o.height,degree:n}),i=e.width/e.height,i!==s.aspectRatio&&(s.left-=(e.width-s.width)/2,s.top-=(e.height-s.height)/2,s.width=e.width,s.height=e.height,s.aspectRatio=i,s.naturalWidth=a,s.naturalHeight=h,n%180&&(e=c({width:a,height:h,degree:n}),s.naturalWidth=e.width,s.naturalHeight=e.height),this.limitCanvas(!0,!1))),(s.width>s.maxWidth||s.width<s.minWidth)&&(s.left=s.oldLeft),(s.height>s.maxHeight||s.height<s.minHeight)&&(s.top=s.oldTop),s.width=ft(mt(s.width,s.minWidth),s.maxWidth),s.height=ft(mt(s.height,s.minHeight),s.maxHeight),this.limitCanvas(!1,!0),s.oldLeft=s.left=ft(mt(s.left,s.minLeft),s.maxLeft),s.oldTop=s.top=ft(mt(s.top,s.minTop),s.maxTop),this.$canvas.css({width:s.width,height:s.height,left:s.left,top:s.top}),this.renderImage(),this.isCropped&&this.isLimited&&this.limitCropBox(!0,!0),t&&this.output()},renderImage:function(i){var e,s=this.canvas,o=this.image;o.rotate&&(e=c({width:s.width,height:s.height,degree:o.rotate,aspectRatio:o.aspectRatio},!0)),t.extend(o,e?{width:e.width,height:e.height,left:(s.width-e.width)/2,top:(s.height-e.height)/2}:{width:s.width,height:s.height,left:0,top:0}),this.$clone.css({width:o.width,height:o.height,marginLeft:o.left,marginTop:o.top,transform:p(o)}),i&&this.output()},initCropBox:function(){var i=this.options,e=this.canvas,s=i.aspectRatio,o=ut(i.autoCropArea)||.8,n={width:e.width,height:e.height};s&&(e.height*s>e.width?n.height=n.width/s:n.width=n.height*s),this.cropBox=n,this.limitCropBox(!0,!0),n.width=ft(mt(n.width,n.minWidth),n.maxWidth),n.height=ft(mt(n.height,n.minHeight),n.maxHeight),n.width=mt(n.minWidth,n.width*o),n.height=mt(n.minHeight,n.height*o),n.oldLeft=n.left=e.left+(e.width-n.width)/2,n.oldTop=n.top=e.top+(e.height-n.height)/2,this.initialCropBox=t.extend({},n)},limitCropBox:function(t,i){var e,s,o,n,a=this.options,h=a.aspectRatio,r=this.container,p=r.width,c=r.height,d=this.canvas,l=this.cropBox,g=this.isLimited;t&&(e=ut(a.minCropBoxWidth)||0,s=ut(a.minCropBoxHeight)||0,e=ft(e,p),s=ft(s,c),o=ft(p,g?d.width:p),n=ft(c,g?d.height:c),h&&(e&&s?s*h>e?s=e/h:e=s*h:e?s=e/h:s&&(e=s*h),n*h>o?n=o/h:o=n*h),l.minWidth=ft(e,o),l.minHeight=ft(s,n),l.maxWidth=o,l.maxHeight=n),i&&(g?(l.minLeft=mt(0,d.left),l.minTop=mt(0,d.top),l.maxLeft=ft(p,d.left+d.width)-l.width,l.maxTop=ft(c,d.top+d.height)-l.height):(l.minLeft=0,l.minTop=0,l.maxLeft=p-l.width,l.maxTop=c-l.height))},renderCropBox:function(){var t=this.options,i=this.container,e=i.width,s=i.height,o=this.cropBox;(o.width>o.maxWidth||o.width<o.minWidth)&&(o.left=o.oldLeft),(o.height>o.maxHeight||o.height<o.minHeight)&&(o.top=o.oldTop),o.width=ft(mt(o.width,o.minWidth),o.maxWidth),o.height=ft(mt(o.height,o.minHeight),o.maxHeight),this.limitCropBox(!1,!0),o.oldLeft=o.left=ft(mt(o.left,o.minLeft),o.maxLeft),o.oldTop=o.top=ft(mt(o.top,o.minTop),o.maxTop),t.movable&&t.cropBoxMovable&&this.$face.data(J,o.width===e&&o.height===s?ct:rt),this.$cropBox.css({width:o.width,height:o.height,left:o.left,top:o.top}),this.isCropped&&this.isLimited&&this.limitCanvas(!0,!0),this.isDisabled||this.output()},output:function(){this.preview(),this.isCompleted?this.trigger(q,this.getData()):this.isBuilt||this.$element.one(A,t.proxy(function(){this.trigger(q,this.getData())},this))}}),t.extend(Bt,{initPreview:function(){var i=h(this.crossOrigin),e=i?this.crossOriginUrl:this.url;this.$preview=t(this.options.preview),this.$viewBox.html("<img"+i+' src="'+e+'">'),this.$preview.each(function(){var s=t(this);s.data(G,{width:s.width(),height:s.height(),html:s.html()}),s.html("<img"+i+' src="'+e+'" style="display:block;width:100%;height:auto;min-width:0!important;min-height:0!important;max-width:none!important;max-height:none!important;image-orientation:0deg!important;">')})},resetPreview:function(){this.$preview.each(function(){var i=t(this),e=i.data(G);i.css({width:e.width,height:e.height}).html(e.html).removeData(G)})},preview:function(){var i=this.image,e=this.canvas,s=this.cropBox,o=s.width,n=s.height,a=i.width,h=i.height,r=s.left-e.left-i.left,c=s.top-e.top-i.top;this.isCropped&&!this.isDisabled&&(this.$viewBox.find("img").css({width:a,height:h,marginLeft:-r,marginTop:-c,transform:p(i)}),this.$preview.each(function(){var e=t(this),s=e.data(G),d=s.width,l=s.height,g=d,u=l,f=1;o&&(f=d/o,u=n*f),n&&u>l&&(f=l/n,g=o*f,u=l),e.css({width:g,height:u}).find("img").css({width:a*f,height:h*f,marginLeft:-r*f,marginTop:-c*f,transform:p(i)})}))}}),t.extend(Bt,{bind:function(){var i=this.options,e=this.$element,s=this.$cropper;t.isFunction(i.cropstart)&&e.on(j,i.cropstart),t.isFunction(i.cropmove)&&e.on(S,i.cropmove),t.isFunction(i.cropend)&&e.on(N,i.cropend),t.isFunction(i.crop)&&e.on(q,i.crop),t.isFunction(i.zoom)&&e.on(_,i.zoom),s.on(R,t.proxy(this.cropStart,this)),i.zoomable&&i.zoomOnWheel&&s.on(O,t.proxy(this.wheel,this)),i.toggleDragModeOnDblclick&&s.on(E,t.proxy(this.dblclick,this)),w.on(H,this._cropMove=o(this.cropMove,this)).on(z,this._cropEnd=o(this.cropEnd,this)),i.responsive&&v.on(P,this._resize=o(this.resize,this))},unbind:function(){var i=this.options,e=this.$element,s=this.$cropper;t.isFunction(i.cropstart)&&e.off(j,i.cropstart),t.isFunction(i.cropmove)&&e.off(S,i.cropmove),t.isFunction(i.cropend)&&e.off(N,i.cropend),t.isFunction(i.crop)&&e.off(q,i.crop),t.isFunction(i.zoom)&&e.off(_,i.zoom),s.off(R,this.cropStart),i.zoomable&&i.zoomOnWheel&&s.off(O,this.wheel),i.toggleDragModeOnDblclick&&s.off(E,this.dblclick),w.off(H,this._cropMove).off(z,this._cropEnd),i.responsive&&v.off(P,this._resize)}}),t.extend(Bt,{resize:function(){var i,e,s,o=this.options.restore,n=this.$container,a=this.container;!this.isDisabled&&a&&(s=n.width()/a.width,(1!==s||n.height()!==a.height)&&(o&&(i=this.getCanvasData(),e=this.getCropBoxData()),this.render(),o&&(this.setCanvasData(t.each(i,function(t,e){i[t]=e*s})),this.setCropBoxData(t.each(e,function(t,i){e[t]=i*s})))))},dblclick:function(){this.isDisabled||(this.$dragBox.hasClass(W)?this.setDragMode(ct):this.setDragMode(pt))},wheel:function(t){var i=t.originalEvent,e=i||t,s=ut(this.options.wheelZoomRatio)||.1,o=1;this.isDisabled||(t.preventDefault(),e.deltaY?o=e.deltaY>0?1:-1:e.wheelDelta?o=-e.wheelDelta/120:e.detail&&(o=e.detail>0?1:-1),this.zoom(-o*s,i))},cropStart:function(i){var e,s,o=this.options,n=i.originalEvent,a=n&&n.touches,h=i;if(!this.isDisabled){if(a){if(e=a.length,e>1){if(!o.zoomable||!o.zoomOnTouch||2!==e)return;h=a[1],this.startX2=h.pageX,this.startY2=h.pageY,s=dt}h=a[0]}if(s=s||t(h.target).data(J),Z.test(s)){if(this.trigger(j,{originalEvent:n,action:s}).isDefaultPrevented())return;i.preventDefault(),this.action=s,this.cropping=!1,this.startX=h.pageX||n&&n.pageX,this.startY=h.pageY||n&&n.pageY,s===pt&&(this.cropping=!0,this.$dragBox.addClass($))}}},cropMove:function(t){var i,e=this.options,s=t.originalEvent,o=s&&s.touches,n=t,a=this.action;if(!this.isDisabled){if(o){if(i=o.length,i>1){if(!e.zoomable||!e.zoomOnTouch||2!==i)return;n=o[1],this.endX2=n.pageX,this.endY2=n.pageY}n=o[0]}if(a){if(this.trigger(S,{originalEvent:s,action:a}).isDefaultPrevented())return;t.preventDefault(),this.endX=n.pageX||s&&s.pageX,this.endY=n.pageY||s&&s.pageY,this.change(n.shiftKey,a===dt?s:null)}}},cropEnd:function(t){var i=t.originalEvent,e=this.action;this.isDisabled||e&&(t.preventDefault(),this.cropping&&(this.cropping=!1,this.$dragBox.toggleClass($,this.isCropped&&this.options.modal)),this.action="",this.trigger(N,{originalEvent:i,action:e}))}}),t.extend(Bt,{change:function(t,i){var e,s,o=this.options,n=o.aspectRatio,a=this.action,h=this.container,r=this.canvas,p=this.cropBox,c=p.width,d=p.height,l=p.left,g=p.top,u=l+c,f=g+d,m=0,v=0,w=h.width,x=h.height,C=!0;switch(!n&&t&&(n=c&&d?c/d:1),this.limited&&(m=p.minLeft,v=p.minTop,w=m+ft(h.width,r.width),x=v+ft(h.height,r.height)),s={x:this.endX-this.startX,y:this.endY-this.startY},n&&(s.X=s.y*n,s.Y=s.x/n),a){case rt:l+=s.x,g+=s.y;break;case tt:if(s.x>=0&&(u>=w||n&&(v>=g||f>=x))){C=!1;break}c+=s.x,n&&(d=c/n,g-=s.Y/2),0>c&&(a=it,c=0);break;case st:if(s.y<=0&&(v>=g||n&&(m>=l||u>=w))){C=!1;break}d-=s.y,g+=s.y,n&&(c=d*n,l+=s.X/2),0>d&&(a=et,d=0);break;case it:if(s.x<=0&&(m>=l||n&&(v>=g||f>=x))){C=!1;break}c-=s.x,l+=s.x,n&&(d=c/n,g+=s.Y/2),0>c&&(a=tt,c=0);break;case et:if(s.y>=0&&(f>=x||n&&(m>=l||u>=w))){C=!1;break}d+=s.y,n&&(c=d*n,l-=s.X/2),0>d&&(a=st,d=0);break;case at:if(n){if(s.y<=0&&(v>=g||u>=w)){C=!1;break}d-=s.y,g+=s.y,c=d*n}else s.x>=0?w>u?c+=s.x:s.y<=0&&v>=g&&(C=!1):c+=s.x,s.y<=0?g>v&&(d-=s.y,g+=s.y):(d-=s.y,g+=s.y);0>c&&0>d?(a=nt,d=0,c=0):0>c?(a=ht,c=0):0>d&&(a=ot,d=0);break;case ht:if(n){if(s.y<=0&&(v>=g||m>=l)){C=!1;break}d-=s.y,g+=s.y,c=d*n,l+=s.X}else s.x<=0?l>m?(c-=s.x,l+=s.x):s.y<=0&&v>=g&&(C=!1):(c-=s.x,l+=s.x),s.y<=0?g>v&&(d-=s.y,g+=s.y):(d-=s.y,g+=s.y);0>c&&0>d?(a=ot,d=0,c=0):0>c?(a=at,c=0):0>d&&(a=nt,d=0);break;case nt:if(n){if(s.x<=0&&(m>=l||f>=x)){C=!1;break}c-=s.x,l+=s.x,d=c/n}else s.x<=0?l>m?(c-=s.x,l+=s.x):s.y>=0&&f>=x&&(C=!1):(c-=s.x,l+=s.x),s.y>=0?x>f&&(d+=s.y):d+=s.y;0>c&&0>d?(a=at,d=0,c=0):0>c?(a=ot,c=0):0>d&&(a=ht,d=0);break;case ot:if(n){if(s.x>=0&&(u>=w||f>=x)){C=!1;break}c+=s.x,d=c/n}else s.x>=0?w>u?c+=s.x:s.y>=0&&f>=x&&(C=!1):c+=s.x,s.y>=0?x>f&&(d+=s.y):d+=s.y;0>c&&0>d?(a=ht,d=0,c=0):0>c?(a=nt,c=0):0>d&&(a=at,d=0);break;case ct:this.move(s.x,s.y),C=!1;break;case dt:this.zoom(function(t,i,e,s){var o=Ct(t*t+i*i),n=Ct(e*e+s*s);return(n-o)/o}(vt(this.startX-this.startX2),vt(this.startY-this.startY2),vt(this.endX-this.endX2),vt(this.endY-this.endY2)),i),this.startX2=this.endX2,this.startY2=this.endY2,C=!1;break;case pt:if(!s.x||!s.y){C=!1;break}e=this.$cropper.offset(),l=this.startX-e.left,g=this.startY-e.top,c=p.minWidth,d=p.minHeight,s.x>0?a=s.y>0?ot:at:s.x<0&&(l-=c,a=s.y>0?nt:ht),s.y<0&&(g-=d),this.isCropped||(this.$cropBox.removeClass(T),this.isCropped=!0,this.limited&&this.limitCropBox(!0,!0))}C&&(p.width=c,p.height=d,p.left=l,p.top=g,this.action=a,this.renderCropBox()),this.startX=this.endX,this.startY=this.endY}}),t.extend(Bt,{crop:function(){this.isBuilt&&!this.isDisabled&&(this.isCropped||(this.isCropped=!0,this.limitCropBox(!0,!0),this.options.modal&&this.$dragBox.addClass($),this.$cropBox.removeClass(T)),this.setCropBoxData(this.initialCropBox))},reset:function(){this.isBuilt&&!this.isDisabled&&(this.image=t.extend({},this.initialImage),this.canvas=t.extend({},this.initialCanvas),this.cropBox=t.extend({},this.initialCropBox),this.renderCanvas(),this.isCropped&&this.renderCropBox())},clear:function(){this.isCropped&&!this.isDisabled&&(t.extend(this.cropBox,{left:0,top:0,width:0,height:0}),this.isCropped=!1,this.renderCropBox(),this.limitCanvas(!0,!0),this.renderCanvas(),this.$dragBox.removeClass($),this.$cropBox.addClass(T))},replace:function(t){!this.isDisabled&&t&&(this.isImg&&(this.isReplaced=!0,this.$element.attr("src",t)),this.options.data=null,this.load(t))},enable:function(){this.isBuilt&&(this.isDisabled=!1,this.$cropper.removeClass(X))},disable:function(){this.isBuilt&&(this.isDisabled=!0,this.$cropper.addClass(X))},destroy:function(){var t=this.$element;this.isLoaded?(this.isImg&&this.isReplaced&&t.attr("src",this.originalUrl),this.unbuild(),t.removeClass(T)):this.isImg?t.off(U,this.start):this.$clone&&this.$clone.remove(),t.removeData(D)},move:function(t,i){var s=this.canvas;this.moveTo(e(t)?t:s.left+ut(t),e(i)?i:s.top+ut(i))},moveTo:function(t,s){var o=this.canvas,n=!1;e(s)&&(s=t),t=ut(t),s=ut(s),this.isBuilt&&!this.isDisabled&&this.options.movable&&(i(t)&&(o.left=t,n=!0),i(s)&&(o.top=s,n=!0),n&&this.renderCanvas(!0))},zoom:function(t,i){var e=this.canvas;t=ut(t),t=0>t?1/(1-t):1+t,this.zoomTo(e.width*t/e.naturalWidth,i)},zoomTo:function(t,i){var e,s,o=this.options,n=this.canvas,a=n.width,h=n.height,r=n.naturalWidth,p=n.naturalHeight;if(t=ut(t),t>=0&&this.isBuilt&&!this.isDisabled&&o.zoomable){if(e=r*t,s=p*t,this.trigger(_,{originalEvent:i,oldRatio:a/r,ratio:e/r}).isDefaultPrevented())return;n.left-=(e-a)/2,n.top-=(s-h)/2,n.width=e,n.height=s,this.renderCanvas(!0)}},rotate:function(t){this.rotateTo((this.image.rotate||0)+ut(t))},rotateTo:function(t){t=ut(t),i(t)&&this.isBuilt&&!this.isDisabled&&this.options.rotatable&&(this.image.rotate=t%360,this.isRotated=!0,this.renderCanvas(!0))},scale:function(t,s){var o=this.image,n=!1;e(s)&&(s=t),t=ut(t),s=ut(s),this.isBuilt&&!this.isDisabled&&this.options.scalable&&(i(t)&&(o.scaleX=t,n=!0),i(s)&&(o.scaleY=s,n=!0),n&&this.renderImage(!0))},scaleX:function(t){var e=this.image.scaleY;this.scale(t,i(e)?e:1)},scaleY:function(t){var e=this.image.scaleX;this.scale(i(e)?e:1,t)},getData:function(i){var e,s,o=this.options,n=this.image,a=this.canvas,h=this.cropBox;return this.isBuilt&&this.isCropped?(s={x:h.left-a.left,y:h.top-a.top,width:h.width,height:h.height},e=n.width/n.naturalWidth,t.each(s,function(t,o){o/=e,s[t]=i?bt(o):o})):s={x:0,y:0,width:0,height:0},o.rotatable&&(s.rotate=n.rotate||0),o.scalable&&(s.scaleX=n.scaleX||1,s.scaleY=n.scaleY||1),s},setData:function(e){var s,o,n,a=this.options,h=this.image,r=this.canvas,p={};t.isFunction(e)&&(e=e.call(this.element)),this.isBuilt&&!this.isDisabled&&t.isPlainObject(e)&&(a.rotatable&&i(e.rotate)&&e.rotate!==h.rotate&&(h.rotate=e.rotate,this.isRotated=s=!0),a.scalable&&(i(e.scaleX)&&e.scaleX!==h.scaleX&&(h.scaleX=e.scaleX,o=!0),i(e.scaleY)&&e.scaleY!==h.scaleY&&(h.scaleY=e.scaleY,o=!0)),s?this.renderCanvas():o&&this.renderImage(),n=h.width/h.naturalWidth,i(e.x)&&(p.left=e.x*n+r.left),i(e.y)&&(p.top=e.y*n+r.top),i(e.width)&&(p.width=e.width*n),i(e.height)&&(p.height=e.height*n),this.setCropBoxData(p))},getContainerData:function(){return this.isBuilt?this.container:{}},getImageData:function(){return this.isLoaded?this.image:{}},getCanvasData:function(){var i=this.canvas,e={};return this.isBuilt&&t.each(["left","top","width","height","naturalWidth","naturalHeight"],function(t,s){e[s]=i[s]}),e},setCanvasData:function(e){var s=this.canvas,o=s.aspectRatio;t.isFunction(e)&&(e=e.call(this.$element)),this.isBuilt&&!this.isDisabled&&t.isPlainObject(e)&&(i(e.left)&&(s.left=e.left),i(e.top)&&(s.top=e.top),i(e.width)?(s.width=e.width,s.height=e.width/o):i(e.height)&&(s.height=e.height,s.width=e.height*o),this.renderCanvas(!0))},getCropBoxData:function(){var t,i=this.cropBox;return this.isBuilt&&this.isCropped&&(t={left:i.left,top:i.top,width:i.width,height:i.height}),t||{}},setCropBoxData:function(e){var s,o,n=this.cropBox,a=this.options.aspectRatio;t.isFunction(e)&&(e=e.call(this.$element)),this.isBuilt&&this.isCropped&&!this.isDisabled&&t.isPlainObject(e)&&(i(e.left)&&(n.left=e.left),i(e.top)&&(n.top=e.top),i(e.width)&&e.width!==n.width&&(s=!0,n.width=e.width),i(e.height)&&e.height!==n.height&&(o=!0,n.height=e.height),a&&(s?n.height=n.width/a:o&&(n.width=n.height*a)),this.renderCropBox())},getCroppedCanvas:function(i){var e,s,o,n,a,h,r,p,c,l,g;return this.isBuilt&&this.isCropped&&gt?(t.isPlainObject(i)||(i={}),g=this.getData(),e=g.width,s=g.height,p=e/s,t.isPlainObject(i)&&(a=i.width,h=i.height,a?(h=a/p,r=a/e):h&&(a=h*p,r=h/s)),o=bt(a||e),n=bt(h||s),c=t("<canvas>")[0],c.width=o,c.height=n,l=c.getContext("2d"),i.fillColor&&(l.fillStyle=i.fillColor,l.fillRect(0,0,o,n)),l.drawImage.apply(l,function(){var t,i,o,n,a,h,p=d(this.$clone[0],this.image),c=p.width,l=p.height,u=[p],f=g.x,m=g.y;return-e>=f||f>c?f=t=o=a=0:0>=f?(o=-f,f=0,t=a=ft(c,e+f)):c>=f&&(o=0,t=a=ft(e,c-f)),0>=t||-s>=m||m>l?m=i=n=h=0:0>=m?(n=-m,m=0,i=h=ft(l,s+m)):l>=m&&(n=0,i=h=ft(s,l-m)),u.push(yt(f),yt(m),yt(t),yt(i)),r&&(o*=r,n*=r,a*=r,h*=r),a>0&&h>0&&u.push(yt(o),yt(n),yt(a),yt(h)),u}.call(this)),c):void 0},setAspectRatio:function(t){var i=this.options;this.isDisabled||e(t)||(i.aspectRatio=mt(0,t)||NaN,this.isBuilt&&(this.initCropBox(),this.isCropped&&this.renderCropBox()))},setDragMode:function(t){var i,e,s=this.options;this.isLoaded&&!this.isDisabled&&(i=t===pt,e=s.movable&&t===ct,t=i||e?t:lt,this.$dragBox.data(J,t).toggleClass(W,i).toggleClass(M,e),s.cropBoxMovable||this.$face.data(J,t).toggleClass(W,i).toggleClass(M,e))}}),t.extend(m.prototype,Bt),m.DEFAULTS={viewMode:0,dragMode:"crop",aspectRatio:NaN,data:null,preview:"",responsive:!0,restore:!0,checkCrossOrigin:!0,checkOrientation:!0,modal:!0,guides:!0,center:!0,highlight:!0,background:!0,autoCrop:!0,autoCropArea:.8,movable:!0,rotatable:!0,scalable:!0,zoomable:!0,zoomOnTouch:!0,zoomOnWheel:!0,wheelZoomRatio:.1,cropBoxMovable:!0,cropBoxResizable:!0,toggleDragModeOnDblclick:!0,minCanvasWidth:0,minCanvasHeight:0,minCropBoxWidth:0,minCropBoxHeight:0,minContainerWidth:200,minContainerHeight:100,build:null,built:null,cropstart:null,cropmove:null,cropend:null,crop:null,zoom:null},m.setDefaults=function(i){t.extend(m.DEFAULTS,i)},m.TEMPLATE='<div class="cropper-container"><div class="cropper-wrap-box"><div class="cropper-canvas"></div></div><div class="cropper-drag-box"></div><div class="cropper-crop-box"><span class="cropper-view-box"></span><span class="cropper-dashed dashed-h"></span><span class="cropper-dashed dashed-v"></span><span class="cropper-center"></span><span class="cropper-face"></span><span class="cropper-line line-e" data-action="e"></span><span class="cropper-line line-n" data-action="n"></span><span class="cropper-line line-w" data-action="w"></span><span class="cropper-line line-s" data-action="s"></span><span class="cropper-point point-e" data-action="e"></span><span class="cropper-point point-n" data-action="n"></span><span class="cropper-point point-w" data-action="w"></span><span class="cropper-point point-s" data-action="s"></span><span class="cropper-point point-ne" data-action="ne"></span><span class="cropper-point point-nw" data-action="nw"></span><span class="cropper-point point-sw" data-action="sw"></span><span class="cropper-point point-se" data-action="se"></span></div></div>',m.other=t.fn.cropper,t.fn.cropper=function(i){var o,n=s(arguments,1);return this.each(function(){var e,s=t(this),a=s.data(D);if(!a){if(/destroy/.test(i))return;s.data(D,a=new m(this,i))}"string"==typeof i&&t.isFunction(e=a[i])&&(o=e.apply(a,n))}),e(o)?this:o},t.fn.cropper.Constructor=m,t.fn.cropper.setDefaults=m.setDefaults,t.fn.cropper.noConflict=function(){return t.fn.cropper=m.other,this}}),function(){"use strict";angular.module("ngCropper",["ng"]).directive("ngCropper",["$q","$parse",function(t,i){function e(i,e){i=i||{};var o=t.when(i);return i.maximize&&(o=s(i,e)),o}function s(t,i){return o(i).then(function(i){return t.data=i,t})}function o(i){var e=t.defer(),s=new Image;return s.onload=function(){e.resolve({width:s.width,height:s.height})},s.src=i.src,e.promise}return{restrict:"A",scope:{options:"=ngCropperOptions",proxy:"=ngCropperProxy",showEvent:"=ngCropperShow",hideEvent:"=ngCropperHide"},link:function(t,s,o){function n(e){if(t.proxy){var s=i(t.proxy).assign;s(t.$parent,e.cropper.bind(e))}}var a=!1;t.$on(t.showEvent,function(){a||(a=!0,e(t.options,s[0]).then(function(t){n(s),s.cropper(t)}))}),t.$on(t.hideEvent,function(){a&&(a=!1,s.cropper("destroy"))}),t.$watch("options.disabled",function(t){a&&(t&&s.cropper("disable"),t||s.cropper("enable"))})}}}]).service("Cropper",["$q",function(t){function i(i){var e=t.defer(),s=new Image;return s.onload=function(t){e.resolve(t.target)},s.src=i,e.promise}function e(t){var i=document.createElement("canvas");return i.width=t.width,i.height=t.height,i.style.display="none",document.body.appendChild(i),i}function s(t){t.parentElement.removeChild(t)}this.encode=function(i){var e=t.defer(),s=new FileReader;return s.onload=function(t){e.resolve(t.target.result)},s.readAsDataURL(i),e.promise},this.decode=function(t){for(var i=t.split(";")[0],e=i.split(":")[1],s=atob(t.split(",")[1]),o=new Uint8Array(s.length),n=0;n<s.length;n++)o[n]=s.charCodeAt(n);return new Blob([o],{type:e})},this.crop=function(t,o){var n=this.decode;return this.encode(t).then(i).then(function(i){var a=e(o),h=a.getContext("2d");h.drawImage(i,o.x,o.y,o.width,o.height,0,0,o.width,o.height);var r=a.toDataURL(t.type);return s(a),n(r)})},this.scale=function(t,o){var n=this.decode;return this.encode(t).then(i).then(function(i){var a,h,r,p=i.height,c=i.width;angular.isNumber(o)&&(a=o,h=p*a,r=c*a),angular.isObject(o)&&(a=c/p,h=o.height,r=o.width,h&&!r?r=h*a:r&&!h&&(h=r/a));var d=e(o),l=d.getContext("2d");d.height=h,d.width=r,l.drawImage(i,0,0,c,p,0,0,r,h);var g=d.toDataURL(t.type);return s(d),n(g)})}}])}();
